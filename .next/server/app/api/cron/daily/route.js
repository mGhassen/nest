(()=>{var e={};e.id=903,e.ids=[903],e.modules={92885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},84770:e=>{"use strict";e.exports=require("crypto")},92048:e=>{"use strict";e.exports=require("fs")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},96119:e=>{"use strict";e.exports=require("perf_hooks")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},66374:(e,t,a)=>{"use strict";a.r(t),a.d(t,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>_,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>y});var r={};a.r(r),a.d(r,{POST:()=>c});var o=a(52412),l=a(14293),i=a(94147),n=a(77856),d=a(53544),s=a(86461),u=a(23498);async function c(e){try{if(e.headers.get("X-CRON-KEY")!==process.env.CRON_SECRET)return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=new Date,a=new Date(t.getTime()-12096e5),r=await d.db.update(s.timesheets).set({status:"SUBMITTED",submittedAt:t,updatedAt:t}).where((0,u.xD)((0,u.eq)(s.timesheets.status,"DRAFT"),(0,u.lt)(s.timesheets.weekStart,a))).returning(),o=await d.db.query.timesheets.findMany({where:(0,u.xD)((0,u.eq)(s.timesheets.status,"DRAFT"),(0,u.eg)(s.timesheets.weekStart,a)),with:{employee:!0}});console.log(`Found ${o.length} unsubmitted timesheets`);let l=await d.db.query.employees.findMany({where:(0,u.eq)(s.employees.terminationDate,null)});return console.log(`Recalculating leave balances for ${l.length} employees`),n.NextResponse.json({message:"Daily cron job completed",autoSubmittedTimesheets:r.length,unsubmittedTimesheets:o.length,employeesProcessed:l.length})}catch(e){return console.error("Error in daily cron job:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:l.RouteKind.APP_ROUTE,page:"/api/cron/daily/route",pathname:"/api/cron/daily",filename:"route",bundlePath:"app/api/cron/daily/route"},resolvedPagePath:"/Users/mghassen/Workspace/GPRD/nest/app/api/cron/daily/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:m,workUnitAsyncStorage:y,serverHooks:_}=p;function f(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:y})}},35303:()=>{},53544:(e,t,a)=>{"use strict";a.d(t,{db:()=>d});var r=a(92885),o=a(46928),l=a(91320),i=a(86461);if(!process.env.NEXT_PUBLIC_SUPABASE_URL)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL");if(!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)throw Error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!process.env.DATABASE_URL)throw Error("Missing DATABASE_URL");(0,r.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);let n=(0,l.Z)(process.env.DATABASE_URL),d=(0,o.t)(n,{schema:i})},86461:(e,t,a)=>{"use strict";a.r(t),a.d(t,{accountRelations:()=>j,accounts:()=>_,auditLogs:()=>P,bankAccounts:()=>C,companies:()=>N,companyRelations:()=>O,contracts:()=>K,costCenters:()=>g,employeePayrollDocuments:()=>q,employeeRelations:()=>X,employees:()=>v,insertCompanySchema:()=>W,insertEmployeePayrollDocumentSchema:()=>ee,insertEmployeeSchema:()=>Z,insertLeavePolicySchema:()=>V,insertLeaveRequestSchema:()=>Q,insertTimesheetSchema:()=>J,insertUserSchema:()=>G,leaveBalances:()=>S,leavePolicies:()=>E,leaveRequestRelations:()=>z,leaveRequests:()=>b,locations:()=>h,membershipRelations:()=>M,memberships:()=>A,payItems:()=>k,paySchedules:()=>U,payrollCycles:()=>R,payrollItems:()=>x,payrollRunRelations:()=>$,payrollRuns:()=>T,sessionRelations:()=>H,sessions:()=>f,timesheetEntries:()=>B,timesheetEntryRelations:()=>Y,timesheetRelations:()=>F,timesheets:()=>w,userRelations:()=>D,users:()=>y,verificationTokens:()=>L,workSchedules:()=>I});var r=a(65431),o=a(71765),l=a(76255),i=a(46936),n=a(94594),d=a(52139),s=a(10061),u=a(27897),c=a(37519),p=a(29527),m=a(62864);let y=(0,l.af)("users",{id:(0,i.L7)("id").primaryKey(),email:(0,i.L7)("email").unique().notNull(),firstName:(0,i.L7)("first_name"),lastName:(0,i.L7)("last_name"),profileImageUrl:(0,i.L7)("profile_image_url"),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),_=(0,l.af)("accounts",{id:(0,i.L7)("id").primaryKey(),userId:(0,i.L7)("user_id").notNull(),provider:(0,i.L7)("provider").notNull(),providerAccountId:(0,i.L7)("provider_account_id").notNull(),refreshToken:(0,i.L7)("refresh_token"),accessToken:(0,i.L7)("access_token"),expiresAt:(0,d._L)("expires_at"),tokenType:(0,i.L7)("token_type"),scope:(0,i.L7)("scope"),idToken:(0,i.L7)("id_token"),sessionState:(0,i.L7)("session_state"),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),f=(0,l.af)("sessions",{id:(0,i.L7)("id").primaryKey(),userId:(0,i.L7)("user_id").notNull(),expires:(0,n.AB)("expires").notNull(),sessionToken:(0,i.L7)("session_token").unique().notNull()}),L=(0,l.af)("verification_tokens",{identifier:(0,i.L7)("identifier").notNull(),token:(0,i.L7)("token").notNull(),expires:(0,n.AB)("expires").notNull()}),N=(0,l.af)("companies",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),name:(0,i.L7)("name").notNull(),countryCode:(0,i.L7)("country_code",{length:2}).notNull(),currency:(0,i.L7)("currency",{length:3}).notNull(),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),A=(0,l.af)("memberships",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),userId:(0,i.L7)("user_id").notNull(),companyId:(0,i.L7)("company_id").notNull(),role:(0,i.L7)("role").notNull(),createdAt:(0,n.AB)("created_at").defaultNow()}),h=(0,l.af)("locations",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),name:(0,i.L7)("name").notNull(),countryCode:(0,i.L7)("country_code",{length:2}).notNull(),timezone:(0,i.L7)("timezone").notNull()}),g=(0,l.af)("cost_centers",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),code:(0,i.L7)("code").notNull(),name:(0,i.L7)("name").notNull()}),I=(0,l.af)("work_schedules",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),name:(0,i.L7)("name").notNull(),weeklyHours:(0,d._L)("weekly_hours").notNull()}),v=(0,l.af)("employees",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),userId:(0,i.L7)("user_id"),firstName:(0,i.L7)("first_name").notNull(),lastName:(0,i.L7)("last_name").notNull(),email:(0,i.L7)("email").notNull(),password:(0,i.L7)("password"),hireDate:(0,s.hT)("hire_date").notNull(),terminationDate:(0,s.hT)("termination_date"),employmentType:(0,i.L7)("employment_type").notNull(),managerId:(0,i.L7)("manager_id"),positionTitle:(0,i.L7)("position_title"),locationId:(0,i.L7)("location_id"),costCenterId:(0,i.L7)("cost_center_id"),baseSalary:(0,u.gH)("base_salary",{precision:10,scale:2}),salaryPeriod:(0,i.L7)("salary_period"),hourlyRate:(0,u.gH)("hourly_rate",{precision:10,scale:2}),workScheduleId:(0,i.L7)("work_schedule_id"),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),w=(0,l.af)("timesheets",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),employeeId:(0,i.L7)("employee_id").notNull(),weekStart:(0,s.hT)("week_start").notNull(),status:(0,i.L7)("status").notNull(),submittedAt:(0,n.AB)("submitted_at"),approvedAt:(0,n.AB)("approved_at"),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),B=(0,l.af)("timesheet_entries",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),timesheetId:(0,i.L7)("timesheet_id").notNull(),date:(0,s.hT)("date").notNull(),project:(0,i.L7)("project"),hours:(0,u.gH)("hours",{precision:4,scale:2}).notNull(),notes:(0,c.fL)("notes")}),E=(0,l.af)("leave_policies",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),code:(0,i.L7)("code").notNull(),name:(0,i.L7)("name").notNull(),accrualRule:(0,c.fL)("accrual_rule").notNull(),unit:(0,i.L7)("unit").notNull(),carryOverMax:(0,u.gH)("carry_over_max",{precision:5,scale:2})}),S=(0,l.af)("leave_balances",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),employeeId:(0,i.L7)("employee_id").notNull(),policyId:(0,i.L7)("policy_id").notNull(),periodStart:(0,s.hT)("period_start").notNull(),periodEnd:(0,s.hT)("period_end").notNull(),opening:(0,u.gH)("opening",{precision:5,scale:2}).notNull(),accrued:(0,u.gH)("accrued",{precision:5,scale:2}).notNull(),taken:(0,u.gH)("taken",{precision:5,scale:2}).notNull(),adjusted:(0,u.gH)("adjusted",{precision:5,scale:2}).notNull(),closing:(0,u.gH)("closing",{precision:5,scale:2}).notNull()}),b=(0,l.af)("leave_requests",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),employeeId:(0,i.L7)("employee_id").notNull(),policyId:(0,i.L7)("policy_id").notNull(),startDate:(0,s.hT)("start_date").notNull(),endDate:(0,s.hT)("end_date").notNull(),unit:(0,i.L7)("unit").notNull(),quantity:(0,u.gH)("quantity",{precision:5,scale:2}).notNull(),status:(0,i.L7)("status").notNull(),approverId:(0,i.L7)("approver_id"),approvedAt:(0,n.AB)("approved_at"),reason:(0,c.fL)("reason"),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),k=(0,l.af)("pay_items",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),code:(0,i.L7)("code").notNull(),name:(0,i.L7)("name").notNull(),type:(0,i.L7)("type").notNull(),formula:(0,c.fL)("formula"),taxable:(0,p.O7)("taxable").default(!0),recurring:(0,p.O7)("recurring").default(!1)}),R=(0,l.af)("payroll_cycles",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),periodStart:(0,s.hT)("period_start").notNull(),periodEnd:(0,s.hT)("period_end").notNull(),status:(0,i.L7)("status").notNull(),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),T=(0,l.af)("payroll_runs",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),cycleId:(0,i.L7)("cycle_id").notNull(),employeeId:(0,i.L7)("employee_id").notNull(),gross:(0,u.gH)("gross",{precision:10,scale:2}).default("0"),net:(0,u.gH)("net",{precision:10,scale:2}).default("0"),currency:(0,i.L7)("currency",{length:3}).notNull(),payslipUrl:(0,i.L7)("payslip_url"),generatedAt:(0,n.AB)("generated_at")}),x=(0,l.af)("payroll_items",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),runId:(0,i.L7)("run_id").notNull(),payItemId:(0,i.L7)("pay_item_id").notNull(),label:(0,i.L7)("label").notNull(),amount:(0,u.gH)("amount",{precision:10,scale:2}).notNull()}),C=(0,l.af)("bank_accounts",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),employeeId:(0,i.L7)("employee_id").notNull(),iban:(0,i.L7)("iban").notNull(),bic:(0,i.L7)("bic"),holderName:(0,i.L7)("holder_name").notNull(),primary:(0,p.O7)("primary").default(!0)}),K=(0,l.af)("contracts",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),employeeId:(0,i.L7)("employee_id").notNull(),title:(0,i.L7)("title").notNull(),version:(0,d._L)("version").default(1),templateId:(0,i.L7)("template_id"),signedAt:(0,n.AB)("signed_at"),fileUrl:(0,i.L7)("file_url"),variables:(0,c.fL)("variables"),createdAt:(0,n.AB)("created_at").defaultNow(),updatedAt:(0,n.AB)("updated_at").defaultNow()}),U=(0,l.af)("pay_schedules",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),cadence:(0,i.L7)("cadence").notNull(),anchorDay:(0,d._L)("anchor_day")}),q=(0,l.af)("employee_payroll_documents",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),employeeId:(0,i.L7)("employee_id").notNull(),fileName:(0,i.L7)("file_name").notNull(),documentUrl:(0,i.L7)("document_url").notNull(),payrollMonth:(0,i.L7)("payroll_month").notNull(),payrollYear:(0,d._L)("payroll_year").notNull(),uploadedAt:(0,n.AB)("uploaded_at").defaultNow(),uploadedBy:(0,i.L7)("uploaded_by").notNull(),createdAt:(0,n.AB)("created_at").defaultNow()}),P=(0,l.af)("audit_logs",{id:(0,i.L7)("id").primaryKey().default((0,r.i6)`gen_random_uuid()`),companyId:(0,i.L7)("company_id").notNull(),actorId:(0,i.L7)("actor_id"),action:(0,i.L7)("action").notNull(),entityType:(0,i.L7)("entity_type").notNull(),entityId:(0,i.L7)("entity_id").notNull(),before:(0,c.fL)("before"),after:(0,c.fL)("after"),createdAt:(0,n.AB)("created_at").defaultNow()}),D=(0,o.lE)(y,({many:e})=>({accounts:e(_),sessions:e(f),memberships:e(A),employee:e(v)})),j=(0,o.lE)(_,({one:e})=>({user:e(y,{fields:[_.userId],references:[y.id]})})),H=(0,o.lE)(f,({one:e})=>({user:e(y,{fields:[f.userId],references:[y.id]})})),O=(0,o.lE)(N,({many:e})=>({memberships:e(A),employees:e(v),locations:e(h),costCenters:e(g),workSchedules:e(I),leavePolicies:e(E),payItems:e(k),payrollCycles:e(R),paySchedules:e(U),auditLogs:e(P)})),M=(0,o.lE)(A,({one:e})=>({user:e(y,{fields:[A.userId],references:[y.id]}),company:e(N,{fields:[A.companyId],references:[N.id]})})),X=(0,o.lE)(v,({one:e,many:t})=>({user:e(y,{fields:[v.userId],references:[y.id]}),company:e(N,{fields:[v.companyId],references:[N.id]}),location:e(h,{fields:[v.locationId],references:[h.id]}),costCenter:e(g,{fields:[v.costCenterId],references:[g.id]}),workSchedule:e(I,{fields:[v.workScheduleId],references:[I.id]}),manager:e(v,{fields:[v.managerId],references:[v.id]}),timesheets:t(w),leaveBalances:t(S),leaveRequests:t(b),payrollRuns:t(T),bankAccounts:t(C),contracts:t(K),payrollDocuments:t(q)})),F=(0,o.lE)(w,({one:e,many:t})=>({employee:e(v,{fields:[w.employeeId],references:[v.id]}),entries:t(B)})),Y=(0,o.lE)(B,({one:e})=>({timesheet:e(w,{fields:[B.timesheetId],references:[w.id]})})),z=(0,o.lE)(b,({one:e})=>({employee:e(v,{fields:[b.employeeId],references:[v.id]}),policy:e(E,{fields:[b.policyId],references:[E.id]}),approver:e(v,{fields:[b.approverId],references:[v.id]})})),$=(0,o.lE)(T,({one:e,many:t})=>({cycle:e(R,{fields:[T.cycleId],references:[R.id]}),employee:e(v,{fields:[T.employeeId],references:[v.id]}),items:t(x)})),G=(0,m.fC)(y).omit({id:!0,createdAt:!0,updatedAt:!0}),W=(0,m.fC)(N).omit({id:!0,createdAt:!0,updatedAt:!0}),Z=(0,m.fC)(v).omit({id:!0,createdAt:!0,updatedAt:!0}),J=(0,m.fC)(w).omit({id:!0,createdAt:!0,updatedAt:!0}),Q=(0,m.fC)(b).omit({id:!0,createdAt:!0,updatedAt:!0}),V=(0,m.fC)(E).omit({id:!0}),ee=(0,m.fC)(q).omit({id:!0,createdAt:!0})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[147,706,856],()=>a(66374));module.exports=r})();