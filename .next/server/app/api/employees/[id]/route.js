"use strict";(()=>{var e={};e.id=957,e.ids=[957],e.modules={92885:e=>{e.exports=require("@supabase/supabase-js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},96119:e=>{e.exports=require("perf_hooks")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},26832:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>q,routeModule:()=>v,serverHooks:()=>N,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{DELETE:()=>R,GET:()=>f,PUT:()=>h});var s=t(52412),n=t(14293),a=t(94147),i=t(77856),p=t(7219),d=t(38083),l=t(53544),u=t(86461),m=t(39260),y=t(23498),w=t(26475);let c=w.z.object({firstName:w.z.string().min(1).optional(),lastName:w.z.string().min(1).optional(),email:w.z.string().email().optional(),employmentType:w.z.enum(["FULL_TIME","PART_TIME","CONTRACTOR"]).optional(),hireDate:w.z.string().transform(e=>new Date(e)).optional(),terminationDate:w.z.string().transform(e=>new Date(e)).optional(),positionTitle:w.z.string().optional(),baseSalary:w.z.number().optional(),salaryPeriod:w.z.enum(["MONTHLY","YEARLY"]).optional(),hourlyRate:w.z.number().optional(),managerId:w.z.string().optional(),locationId:w.z.string().optional(),costCenterId:w.z.string().optional(),workScheduleId:w.z.string().optional()});async function f(e,{params:r}){try{let e=await (0,p.getServerSession)(d.a);if(!e?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});if(!await (0,m.wN)(e.user.id))return i.NextResponse.json({error:"User not found"},{status:404});if(!await (0,m.IV)(e.user.id,r.id))return i.NextResponse.json({error:"Forbidden"},{status:403});let t=await l.db.query.employees.findFirst({where:(0,y.eq)(u.employees.id,r.id),with:{location:!0,costCenter:!0,workSchedule:!0,manager:!0,timesheets:!0,leaveRequests:!0,payrollRuns:!0}});if(!t)return i.NextResponse.json({error:"Employee not found"},{status:404});return i.NextResponse.json(t)}catch(e){return console.error("Error fetching employee:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function h(e,{params:r}){try{let t=await (0,p.getServerSession)(d.a);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let o=await (0,m.wN)(t.user.id);if(!o)return i.NextResponse.json({error:"User not found"},{status:404});if(!(0,m.BT)(o.role,"write","employee"))return i.NextResponse.json({error:"Forbidden"},{status:403});let s=await e.json(),n=c.parse(s),a=await l.db.update(u.employees).set({...n,updatedAt:new Date}).where((0,y.eq)(u.employees.id,r.id)).returning();if(!a[0])return i.NextResponse.json({error:"Employee not found"},{status:404});return i.NextResponse.json(a[0])}catch(e){if(e instanceof w.z.ZodError)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error updating employee:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function R(e,{params:r}){try{let e=await (0,p.getServerSession)(d.a);if(!e?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let t=await (0,m.wN)(e.user.id);if(!t)return i.NextResponse.json({error:"User not found"},{status:404});if(!(0,m.BT)(t.role,"delete","employee"))return i.NextResponse.json({error:"Forbidden"},{status:403});if(!(await l.db.delete(u.employees).where((0,y.eq)(u.employees.id,r.id)).returning())[0])return i.NextResponse.json({error:"Employee not found"},{status:404});return i.NextResponse.json({message:"Employee deleted successfully"})}catch(e){return console.error("Error deleting employee:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let v=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/employees/[id]/route",pathname:"/api/employees/[id]",filename:"route",bundlePath:"app/api/employees/[id]/route"},resolvedPagePath:"/Users/mghassen/Workspace/GPRD/nest/app/api/employees/[id]/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:x,workUnitAsyncStorage:g,serverHooks:N}=v;function q(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:g})}},39260:(e,r,t)=>{t.d(r,{BT:()=>p,IV:()=>d,Qg:()=>u,uL:()=>l,wN:()=>i});var o=t(53544),s=t(86461),n=t(23498);let a={OWNER:{employee:["read","write","delete","approve","admin"],timesheet:["read","write","delete","approve","admin"],leave:["read","write","delete","approve","admin"],payroll:["read","write","delete","approve","admin"],company:["read","write","delete","approve","admin"],settings:["read","write","delete","approve","admin"]},ADMIN:{employee:["read","write","delete","approve","admin"],timesheet:["read","write","delete","approve","admin"],leave:["read","write","delete","approve","admin"],payroll:["read","write","delete","approve","admin"],company:["read","write","admin"],settings:["read","write","admin"]},HR:{employee:["read","write","approve"],timesheet:["read","approve"],leave:["read","write","approve"],payroll:["read","write","approve"],company:["read","write"],settings:["read","write"]},MANAGER:{employee:["read"],timesheet:["read","approve"],leave:["read","approve"],payroll:["read"],company:["read"],settings:["read"]},EMPLOYEE:{employee:["read"],timesheet:["read","write"],leave:["read","write"],payroll:["read"],company:["read"],settings:["read"]}};async function i(e){let r=await o.db.query.users.findFirst({where:(0,n.eq)(s.users.id,e),with:{memberships:{with:{company:!0}}}});return r&&r.memberships?.[0]?{id:r.id,email:r.email,role:r.memberships[0].role,companyId:r.memberships[0].companyId}:null}function p(e,r,t){return a[e]?.[t]?.includes(r)||!1}async function d(e,r){let t=await i(e);if(!t)return!1;if(["OWNER","ADMIN","HR"].includes(t.role))return!0;if("MANAGER"===t.role){let t=await o.db.query.employees.findFirst({where:(0,n.eq)(s.employees.id,r)});return t?.managerId===e}if("EMPLOYEE"===t.role){let t=await o.db.query.employees.findFirst({where:(0,n.eq)(s.employees.id,r)});return t?.userId===e}return!1}async function l(e,r){let t=await i(e);if(!t)return!1;if(["OWNER","ADMIN","HR"].includes(t.role))return!0;if("MANAGER"===t.role){let t=await o.db.query.timesheets.findFirst({where:(0,n.eq)(timesheets.id,r),with:{employee:!0}});return t?.employee?.managerId===e}return!1}async function u(e,r){let t=await i(e);if(!t)return!1;if(["OWNER","ADMIN","HR"].includes(t.role))return!0;if("MANAGER"===t.role){let t=await o.db.query.leaveRequests.findFirst({where:(0,n.eq)(leaveRequests.id,r),with:{employee:!0}});return t?.employee?.managerId===e}return!1}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[147,706,715,856,997],()=>t(26832));module.exports=o})();